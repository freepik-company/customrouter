---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.19.0
  name: customhttproutes.customrouter.freepik.com
spec:
  group: customrouter.freepik.com
  names:
    kind: CustomHTTPRoute
    listKind: CustomHTTPRouteList
    plural: customhttproutes
    singular: customhttproute
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - description: Target external processor
      jsonPath: .spec.targetRef.name
      name: Target
      type: string
    - description: Whether the manifest was reconciled
      jsonPath: .status.conditions[?(@.type=='Reconciled')].status
      name: Reconciled
      type: string
    - description: Whether the ConfigMap was synced
      jsonPath: .status.conditions[?(@.type=='ConfigMapSynced')].status
      name: ConfigMapSynced
      type: string
    - jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: CustomHTTPRoute is the Schema for the customhttproutes API
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: spec defines the desired state of CustomHTTPRoute
            properties:
              catchAllRoute:
                description: |-
                  catchAllRoute configures automatic generation of catch-all virtual hosts for this route's hostnames.
                  When specified, the operator generates an EnvoyFilter that creates default routes for the hostnames,
                  allowing CustomHTTPRoute to handle requests without requiring a base HTTPRoute.
                  The hostnames are taken from spec.hostnames; the backendRef defines the default backend.
                properties:
                  backendRef:
                    description: backendRef defines the default backend service to
                      route unmatched requests to.
                    properties:
                      name:
                        description: name is the name of the Service
                        type: string
                      namespace:
                        description: namespace is the namespace of the Service
                        type: string
                      port:
                        description: port is the port of the Service
                        format: int32
                        maximum: 65535
                        minimum: 1
                        type: integer
                    required:
                    - name
                    - namespace
                    - port
                    type: object
                required:
                - backendRef
                type: object
              hostnames:
                description: hostnames is a list of hostnames that this route applies
                  to
                items:
                  type: string
                minItems: 1
                type: array
              pathPrefixes:
                description: pathPrefixes defines prefixes to prepend to paths (e.g.,
                  language prefixes)
                properties:
                  expandMatchTypes:
                    description: |-
                      expandMatchTypes controls which match types are expanded with path prefixes.
                      Accepts a list of match types: "PathPrefix", "Exact", "Regex".
                      When empty or not specified, all match types are expanded (default behavior).
                      Example: ["PathPrefix", "Exact"] expands only PathPrefix and Exact matches.
                    items:
                      description: MatchType defines the type of path matching
                      enum:
                      - PathPrefix
                      - Exact
                      - Regex
                      type: string
                    type: array
                  policy:
                    default: Optional
                    description: |-
                      policy defines how prefixes are applied
                      Optional: generates routes with and without prefix (default)
                      Required: generates routes only with prefix
                      Disabled: generates routes without any prefix
                    enum:
                    - Optional
                    - Required
                    - Disabled
                    type: string
                  values:
                    description: values is the list of prefixes to prepend to paths
                      (e.g., ["es", "fr", "it"])
                    items:
                      type: string
                    type: array
                type: object
              rules:
                description: rules defines the routing rules
                items:
                  description: Rule defines a routing rule
                  properties:
                    actions:
                      description: |-
                        actions defines transformations to apply to matched requests
                        Actions are applied in order: redirect (terminates), rewrite, then header modifications
                      items:
                        description: Action defines an action to perform on a matched
                          request
                        properties:
                          header:
                            description: header specifies header configuration (required
                              when type is "header-set" or "header-add")
                            properties:
                              name:
                                description: name is the header name
                                type: string
                              value:
                                description: |-
                                  value is the header value. Supports variables:
                                  ${client_ip} - client IP address from X-Forwarded-For
                                  ${request_id} - request ID from X-Request-ID header
                                  ${host} - original request host
                                  ${path} - original request path
                                  ${method} - HTTP method (GET, POST, etc.)
                                  ${scheme} - request scheme (http or https)
                                type: string
                            required:
                            - name
                            - value
                            type: object
                          headerName:
                            description: headerName specifies the header name to remove
                              (required when type is "header-remove")
                            type: string
                          redirect:
                            description: |-
                              redirect specifies redirect configuration (required when type is "redirect")
                              When a redirect action is present, the request is not forwarded to the backend
                            properties:
                              hostname:
                                description: hostname is the hostname to redirect
                                  to
                                type: string
                              path:
                                description: |-
                                  path is the path to redirect to. Supports variables:
                                  ${path} - original request path
                                  ${host} - original request host
                                  ${method} - HTTP method (GET, POST, etc.)
                                  ${scheme} - request scheme (http or https)
                                  ${path.segment.N} - Nth segment of the path (0-indexed)
                                type: string
                              port:
                                description: port is the port to redirect to
                                format: int32
                                maximum: 65535
                                minimum: 1
                                type: integer
                              scheme:
                                description: scheme is the scheme to redirect to (http
                                  or https)
                                enum:
                                - http
                                - https
                                type: string
                              statusCode:
                                default: 302
                                description: statusCode is the HTTP status code to
                                  use for the redirect
                                enum:
                                - 301
                                - 302
                                - 303
                                - 307
                                - 308
                                format: int32
                                type: integer
                            type: object
                          rewrite:
                            description: rewrite specifies URL rewrite configuration
                              (required when type is "rewrite")
                            properties:
                              hostname:
                                description: hostname is the new hostname to rewrite
                                  to
                                type: string
                              path:
                                description: |-
                                  path is the new path to rewrite to. Supports variables:
                                  ${path} - original request path
                                  ${host} - original request host
                                  ${method} - HTTP method (GET, POST, etc.)
                                  ${scheme} - request scheme (http or https)
                                  ${path.segment.N} - Nth segment of the path (0-indexed)
                                type: string
                            type: object
                          type:
                            description: type is the type of action to perform
                            enum:
                            - redirect
                            - rewrite
                            - header-set
                            - header-add
                            - header-remove
                            type: string
                        required:
                        - type
                        type: object
                      type: array
                    backendRefs:
                      description: |-
                        backendRefs defines the backend services to route to
                        Required unless actions contains a redirect action
                      items:
                        description: BackendRef defines a reference to a backend service
                        properties:
                          name:
                            description: name is the name of the Service
                            type: string
                          namespace:
                            description: namespace is the namespace of the Service
                            type: string
                          port:
                            description: port is the port of the Service
                            format: int32
                            maximum: 65535
                            minimum: 1
                            type: integer
                        required:
                        - name
                        - namespace
                        - port
                        type: object
                      type: array
                    matches:
                      description: matches defines the conditions for matching this
                        rule
                      items:
                        description: PathMatch defines a path matching rule
                        properties:
                          path:
                            description: path is the value to match against the request
                              path
                            type: string
                          priority:
                            default: 1000
                            description: |-
                              priority defines the order in which routes are evaluated
                              Higher values are evaluated first. Default is 1000.
                            format: int32
                            type: integer
                          type:
                            default: PathPrefix
                            description: |-
                              type is the type of path matching
                              PathPrefix: matches paths starting with this value (default)
                              Exact: matches paths exactly equal to this value
                              Regex: matches paths using Go regexp syntax
                            enum:
                            - PathPrefix
                            - Exact
                            - Regex
                            type: string
                        required:
                        - path
                        type: object
                      minItems: 1
                      type: array
                    pathPrefixes:
                      description: pathPrefixes overrides the spec-level pathPrefixes
                        configuration for this rule
                      properties:
                        expandMatchTypes:
                          description: |-
                            expandMatchTypes overrides the spec-level pathPrefixes.expandMatchTypes for this rule.
                            Accepts a list of match types: "PathPrefix", "Exact", "Regex".
                            When not specified, inherits from spec-level pathPrefixes.expandMatchTypes.
                          items:
                            description: MatchType defines the type of path matching
                            enum:
                            - PathPrefix
                            - Exact
                            - Regex
                            type: string
                          type: array
                        policy:
                          description: policy overrides the spec-level pathPrefixes.policy
                            for this rule
                          enum:
                          - Optional
                          - Required
                          - Disabled
                          type: string
                      required:
                      - policy
                      type: object
                  required:
                  - matches
                  type: object
                minItems: 1
                type: array
              targetRef:
                description: |-
                  targetRef identifies the target external processor for this route.
                  Routes are grouped by targetRef.name into separate ConfigMaps.
                properties:
                  name:
                    description: |-
                      name is the identifier of the target external processor.
                      Routes with the same targetRef.name will be aggregated into the same ConfigMaps.
                      The external processor should be started with --target-name matching this value.
                    maxLength: 63
                    minLength: 1
                    pattern: ^[a-z0-9]([-a-z0-9]*[a-z0-9])?$
                    type: string
                required:
                - name
                type: object
            required:
            - hostnames
            - rules
            - targetRef
            type: object
          status:
            description: status defines the observed state of CustomHTTPRoute
            properties:
              conditions:
                description: The status of each condition is one of True, False, or
                  Unknown.
                items:
                  description: Condition contains details for one aspect of the current
                    state of this API Resource.
                  properties:
                    lastTransitionTime:
                      description: |-
                        lastTransitionTime is the last time the condition transitioned from one status to another.
                        This should be when the underlying condition changed.  If that is not known, then using the time when the API field changed is acceptable.
                      format: date-time
                      type: string
                    message:
                      description: |-
                        message is a human readable message indicating details about the transition.
                        This may be an empty string.
                      maxLength: 32768
                      type: string
                    observedGeneration:
                      description: |-
                        observedGeneration represents the .metadata.generation that the condition was set based upon.
                        For instance, if .metadata.generation is currently 12, but the .status.conditions[x].observedGeneration is 9, the condition is out of date
                        with respect to the current state of the instance.
                      format: int64
                      minimum: 0
                      type: integer
                    reason:
                      description: |-
                        reason contains a programmatic identifier indicating the reason for the condition's last transition.
                        Producers of specific condition types may define expected values and meanings for this field,
                        and whether the values are considered a guaranteed API.
                        The value should be a CamelCase string.
                        This field may not be empty.
                      maxLength: 1024
                      minLength: 1
                      pattern: ^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$
                      type: string
                    status:
                      description: status of the condition, one of True, False, Unknown.
                      enum:
                      - "True"
                      - "False"
                      - Unknown
                      type: string
                    type:
                      description: type of condition in CamelCase or in foo.example.com/CamelCase.
                      maxLength: 316
                      pattern: ^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$
                      type: string
                  required:
                  - lastTransitionTime
                  - message
                  - reason
                  - status
                  - type
                  type: object
                type: array
                x-kubernetes-list-map-keys:
                - type
                x-kubernetes-list-type: map
            type: object
        required:
        - spec
        type: object
    served: true
    storage: true
    subresources:
      status: {}
